<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hexagon Grid</title>
<style>
    .body{
        display: flex;
        flex-direction: column;
    }
    .hex-container {
        position: relative;
        width: 100vw;
        height: 100vh;
    }
    .timers{
      display: flex;
    }
    .status-bar {
      position: absolute;
      top: 20px;
      left: 50%;
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: start;
      gap: 40px;
      padding: 10px 20px;
      border-radius: 12px;
    }
   
    
    .h1{
        position: absolute;
        top: 50%;
        left: 50%;
    }
    .node{
        position: absolute;
        width: 30px;
        height: 30px;
        border-radius: 100%;
        color:black;
        z-index: 2;
        cursor: pointer;
        font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }
    .node:hover {
        background-color: #d5d5dd;
        transform: scale(1.05);
        box-shadow: 0 6px 14px rgba(0, 0, 0, 0.15);
      }
    .p{
        color: black;
        position: absolute;
    }
    
    
</style>
</head>
<body>
    
    <div class="hex-container" id="hex" >
      <div class="status-bar">
        <div class="timers">
          <div class="red-timer">Red: 10:00</div>
          <div class="blue-timer">Blue: 10:00</div>
        </div>
        <div class="displayPlayerMove"></div>
        <div class="display-score"></div>
      </div>
    </div>
   

<script>
    const score = {
        Red: 0,
        Blue: 0
    };

    let redTime = 600;
    let blueTime = 600;
    let intervalId = null;
    let currentMove = "red";

    function renderScore(){
        document.querySelector(".display-score").innerHTML = `Red: ${score.Red}  Blue: ${score.Blue}</p>`;
        document.querySelector(".displayPlayerMove").innerHTML = `${currentMove} to play`
    }
    renderScore();

    function updateTimer(currentMove,time){
      const mins = Math.floor(time/60);
      const secs = Math.floor(time%60);
      document.querySelector(`.${currentMove}-timer`).innerHTML = `${currentMove}: ${mins}:${secs}`;
      if(mins==0 && secs ==0){
        currentMove === "red"? alert("Blue won!") : alert("Red won!")
        location.reload()
      }
    }

    function startTimer(){
      clearInterval(intervalId);
      intervalId = setInterval(() => {
      if(currentMove === "red"){
        redTime--;
        updateTimer("red",redTime);
      }
      else{
        blueTime--;
        updateTimer("blue",blueTime);
      }
    },1000);
  }

  

    //none-0
    //red-1
    //blue-2
    const data=[0,0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
    
    
    const weight=[7,9,8,7,9,7,6,4,6,6,6,5,3,2,2,2,1,2]
    const hex=document.getElementById("hex")
    const xCentre=window.innerWidth/2;
    const r=[100,200,300]
    const yCentre=window.innerHeight/2;
    let k=1;
    let Node={}
    
    for (let i=0;i<3;i++){
        for(let j=0;j<6;j++){
            const angle=(Math.PI/180)*60*j
            let x=xCentre+r[i]*Math.cos(angle)
            let y=yCentre+r[i]*Math.sin(angle)
            x=Math.round(x)
            y=Math.round(y)
            
            
            const node=document.createElement('button')
            node.className="node"
            node.id=k
                node.innerText=`${k}`
                node.style.left=`${x}px`
                node.style.top=`${y}px`
                node.value=k
                node.addEventListener("click",moveTrack)
                hex.appendChild(node)
                Node[k]=[]
                Node[k].push([x,y])
                k=k+1;
                
        }
    }
    
    
    
        
    for(i=1;i<=18;i++)
        {
        
        if(i%6==0){
            const xa=(Node[i][0][0]+Node[i-5][0][0])/2
        const ya=(Node[i][0][1]+Node[i-5][0][1])/2
        const p=document.createElement('p')
        p.className="p"
        p.style.left=`${xa+30}px`
        p.style.top=`${ya+2}px`
        p.innerText=weight[i-1]
       
        document.body.appendChild(p);
        
        }
        if([1,5,3,12,10,8].includes(i)){
            const xa=(Node[i][0][0]+Node[i+6][0][0])/2
            const ya=(Node[i][0][1]+Node[i+6][0][1])/2
            const p=document.createElement('p')
            p.className="p"
            p.style.left=`${xa+30}px`
            p.style.top=`${ya+4}px`
            p.innerText="1"
            
            document.body.appendChild(p);
        }
        if(i%6!=0){
            const xa=(Node[i][0][0]+Node[i+1][0][0])/2
            const ya=(Node[i][0][1]+Node[i+1][0][1])/2
            const p=document.createElement('p')
        p.className="p"
        p.style.left=`${xa+15}px`
        p.style.top=`${ya-5}px`
        p.innerText=weight[i-1]
        
        document.body.appendChild(p);
        
        }
        
    }
    
    
    for(let i=1;i<=18;i++){
        if(i%6!=0){
            drawLine(Node[i][0][0],Node[i][0][1],Node[i+1][0][0],Node[i+1][0][1])
        }
        if([1,5,3,12,10,8].includes(i)){
            drawLine(Node[i][0][0],Node[i][0][1],Node[i+6][0][0],Node[i+6][0][1])
        }
        if(i%6==0){
            drawLine(Node[i][0][0],Node[i][0][1],Node[i-5][0][0],Node[i-5][0][1])
        }
    }
    function drawLine(x1, y1, x2, y2) {
        const line = document.createElement("div");
    
        // Calculate the distance and angle
        const dx = x2 - x1;
        const dy = y2 - y1;
        const length = Math.sqrt(dx * dx + dy * dy);
        const angle = Math.atan2(dy, dx) * (180 / Math.PI); // in degrees
    
        // Style the line
        line.style.position = "absolute";
        line.style.left = `${x1+25}px`;
        line.style.top = `${y1+25}px`;
        line.style.width =` ${length}px`;
        line.style.height = "2px";
        line.style.backgroundColor = "black";
        line.style.transform = `rotate(${angle}deg)`;
        line.style.transformOrigin = "0 0";
    
        document.body.appendChild(line);
    }
    const scoredEdges = {};
    function updateScore() {
        for(let i = 1; i <= 18; i++) {
            if(data[i] !== 0 && data[i+1] !== 0 && data[i] === data[i+1] && i % 6 !== 0){
                const key = `${i}-${i+1}`;
                if (!scoredEdges[key]) {
                    data[i] === 1 ? score.Red += weight[i - 1] : score.Blue += weight[i - 1];
                    scoredEdges[key] = true;
                }
            }
    
            if([1,5,3,12,10,8].includes(i) && data[i] !== 0 && data[i+6] !== 0 && data[i] === data[i+6]){
                const key = `${i}-${i+6}`;
                if (!scoredEdges[key]) {
                    data[i] === 1 ? score.Red += 1 : score.Blue += 1;
                    scoredEdges[key] = true;
                }
            }
    
            else if(i % 6 == 0 && data[i] !== 0 && data[i-5] !== 0 && data[i] === data[i-5]){
                const key = `${i}-${i-5}`;
                if (!scoredEdges[key]) {
                    data[i] === 1 ? score.Red += weight[i - 1] : score.Blue += weight[i - 1];
                    scoredEdges[key] = true;
                }
            }
        }
        renderScore();
    }
    const unlock=[0,0,1,0]
    function Unlock(){
        if(!data.slice(13,19).includes(0)){
            unlock[1]=1;
        }
        if(!data.slice(7,13).includes(0)){
            unlock[0]=1;
        }
        if(!data.slice(1,7).includes(0)){
            unlock[3]=1;
        }
    }
    Unlock()
    function Move(a,b){
        let o=0;
        a=Number(a)
        b=Number(b)
        if((a==12 && b==18) || (a==18 && b==12)){
          data[b]=data[a]
          data[a]=0
          o=1
        }
        else if(b%6==0){
            if(a==b-5||a==b-1){
                data[b]=data[a]
                data[a]=0
                o=1
            }
        }
        else if(a%6==0){
            if(a==b+1||a==b+5){
                data[b]=data[a]
                data[a]=0
                o=1
            }
        }
        else if([1,3,5,8,10,12].includes(a)){
            if(a==b+1||a==b-1||a==b-6){
                data[b]=data[a]
                data[a]=0
                o=1
            }
        }
        else if([1,3,5,8,10,12].includes(b)){
            if(a==b+1||a==b-1||a==b+6){
                data[b]=data[a]
                data[a]=0
                o=1
            }
        }
        else{
            if(a==b+1||a==b-1){
                data[b]=data[a]
                data[a]=0
                o=1
            }
        }
        colorender()
        Change()
        if(o==1){
            
            return true
        }
        else{
            return false
        }
        

    }
    function Change(){
        updateScore();
        Unlock()
        if(unlock[3]==1){
            if(score.Red>score.Blue){
                alert("Red Wins")
                location.reload()
            }
            else{
                alert("Blue Wins")
                location.reload()
            }
        }
    }
    function moveTimer(currentMove){

    }
    const turn=[1,0]//red-0,blue-1
    const move=[0,0]
    const titan=[4,4]
    function createTitan(id){
        const button=document.getElementById(id)
        button.style.backgroundColor=currentMove
        if(currentMove=='red'){
            data[id]=1
        }
        if(currentMove=='blue'){
            data[id]=2
        }
        
    }

  
   const alreadyClicked=[0,0]
    function moveTrack(event){
        if(turn[0]==1){//red turn
            if(data[event.target.value]==0&&unlock[Math.floor(event.target.value/6.1)]==1&&alreadyClicked[0]==0){
                
                if(titan[0]!=0){createTitan(event.target.value)
                    turn[0]=0
                turn[1]=1
                titan[0]-=1
                    currentMove = "blue";
                    startTimer();
                  }
                
            }
            else if(data[event.target.value]==1){
                if(alreadyClicked[0]==0){
                    alreadyClicked[0]=event.target.value
                    console.log(alreadyClicked[0])
                }
               

                
            }
            else if(data[event.target.value]==0&&unlock[Math.floor(event.target.value/6.1)]==1&&alreadyClicked[0]!=0){
               if( Move(alreadyClicked[0],event.target.value)){
                    alreadyClicked[0]=0
                console.log(`b-${event.target.value}`)
                    turn[0]=0
                turn[1]=1
               
                currentMove = "blue"
                startTimer();
            }
        else{
            alreadyClicked[0]=0;
            alreadyClicked[1]=0
        }}
            
            
        }
        else if(turn[1]==1){//blue turn 1
            if(data[event.target.value]==0&&unlock[Math.floor(event.target.value/6.1)]==1&&alreadyClicked[1]==0){
                if(titan[1]!=0){
                    turn[0]=1
                turn[1]=0
                titan[1]-=1
                createTitan(event.target.value)
                currentMove = "red"
                startTimer();
                }
                
            }
            else if(data[event.target.value]==2){
                
                if(alreadyClicked[1]==0){
                    alreadyClicked[1]=event.target.value
                
                }
                
            }
            else if(data[event.target.value]==0&&unlock[Math.floor(event.target.value/6.1)]==1&&alreadyClicked[1]!=0){
               if (Move(alreadyClicked[1],event.target.value)){
                    alreadyClicked[1]=0
                    turn[0]=1
                turn[1]=0
                
                currentMove = "red"
                startTimer();
            }
            else{
                alreadyClicked[0]=0;
                alreadyClicked[1]=0
            }}
            
        }
        else{
            alreadyClicked[0]=0;
            alreadyClicked[1]=0
        }
        Change()
    }
    function colorender(){
        for(i=1;i<=18;i++){
            const button=document.getElementById(i)
            if(data[i]!=0){
                if(data[i]==1){
                    button.style.backgroundColor='red'
                }
                else{
                    button.style.backgroundColor='blue'
                }
            }
            else{
                button.style.backgroundColor=''
            }
            console.log(button)
        }
    }
    
</script>
</body>
</html>