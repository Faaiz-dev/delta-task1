<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Titan's Circuit</title>
  <style>
    body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
  display: flex;
  min-height: 100vh;
  background-color: #ecf0f1;
}

/* Main container */
.main-container {
  display: flex;
  width: 100%;
  position: relative;
}

/* Sidebar styling */
.sidebar {
  width: 200px;
  background-color: #2c3e50;
  color: white;
  padding: 20px;
  height: 100vh;
  z-index: 2;
  overflow: auto;
  transition: transform 0.3s ease;
}

.sidebar.collapsed {
  transform: translateX(-200px);
}

.sidebar h2 {
  color: #ecf0f1;
  margin-top: 0;
}

.sidebar ul {
  list-style: none;
  padding: 0;
}

.sidebar ul li {
  margin: 10px 0;
}

.sidebar ul li a {
  color: #ecf0f1;
  text-decoration: none;
  font-size: 18px;
}

.sidebar ul li a:hover {
  text-decoration: underline;
}

/* Sidebar toggle button */
.sidebar-toggle {
  position: fixed;
  left: 220px;
  top: 20px;
  background-color: #2c3e50;
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 4px;
  cursor: pointer;
  z-index: 3;
  transition: left 0.3s ease;
}

.sidebar-toggle.collapsed {
  left: 20px;
}

/* Center content */
.center-content {
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  transition: margin-left 0.3s ease;
}

/* Move history panel */
.move-history-panel {
  width: 250px;
  padding: 15px;
  background-color: #fff;
  box-shadow: -2px 0 5px rgba(0, 0, 0, 0.1);
  height: 100vh;
  overflow-y: auto;
}

.move-history-panel h3 {
  color: #2c3e50;
  margin-top: 0;
  border-bottom: 1px solid #eee;
  padding-bottom: 10px;
}

.move-history {
  white-space: pre-wrap;
}

/* Hex container */
.hex-container {
  position: relative;
  flex-grow: 1;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1;
  margin-top: 60px;
}

/* Status bar */
.status-bar {
  position: absolute;
  top: 5px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  padding: 10px 20px;
  background: #fff;
  border-radius: 10px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  align-items: center;
  width: 80%;
  max-width: 800px;
}

.status-bar button {
  padding: 6px 12px;
  border: none;
  background-color: #007bff;
  color: white;
  border-radius: 6px;
  cursor: pointer;
}

.status-bar button:hover {
  background-color: #0056b3;
}

.timers {
  display: flex;
  gap: 10px;
  font-weight: bold;
}

.displayPlayerMove, .display-score {
  font-weight: bold;
}

/* Node styling */
.node {
  position: absolute;
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background-color: #f8f9fa;
  border: 2px solid #ccc;
  color: white;
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: transform 0.5s ease-in-out;
  z-index: 2;
}

.node:hover {
  background-color: #e2e6ea;
  transform: scale(1.05);
}

.highlight {
  position: absolute;
  width: 32px;
  height: 32px;
  border-radius: 50%;
  border: 2px solid #fff;
  box-shadow: 0 0 8px rgba(0, 0, 0, 0.3);
  transform: translate(-50%, -50%);
  transition: left 0.5s ease-in-out, top 0.5s ease-in-out, opacity 0.5s ease-in-out, background-color 0.5s ease-in-out;
  opacity: 0;
  z-index: 1;
}

.p {
  position: absolute;
  color: #333;
  font-size: 0.9;
}
  </style>
</head>
<body>
  <audio id="move" src="move.mp3" preload="auto"></audio>
  <audio id="create" src="create.mp3" preload="auto"></audio>
  <audio id="illegal" src="illegal.mp3" preload="auto"></audio>

  <div class="main-container">
    
    <div class="sidebar" id="sidebar">
      <h2>Game Modes</h2>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="normalmode.html">Normal Mode</a></li>
        <li><a href="hackermode.html">Hacker Mode</a></li>
        <li><a href="hackerppmode.html">Hacker ++ Mode</a></li>
      </ul>
    </div>

    <button class="sidebar-toggle" id="sidebar-toggle">◀</button>

  
    <div class="center-content" id="center-content">
      <div class="status-bar">
        <button onclick="isResume(false)">Pause</button>
        <button onclick="isResume(true)">Play</button>
        <div class="timers">
          <div class="red-timer">Red: 10:00</div>
          <div class="blue-timer">Blue: 10:00</div>
        </div>
        <div class="displayPlayerMove"></div>
        <div class="display-score"></div>
        <button class="undo-button" onclick="undo()">Undo</button>
        <button class="Redo-button" onclick="redo()">Redo</button>
      </div>
      <div class="hex-container" id="hex"></div>
    </div>

   
    <div class="move-history-panel">
      <h3>Move History</h3>
      <div class="move-history"></div>
    </div>
  </div>

  
  <script>
    
document.addEventListener('DOMContentLoaded', function() {
    const sidebar = document.getElementById('sidebar');
    const sidebarToggle = document.getElementById('sidebar-toggle');
    const centerContent = document.getElementById('center-content');
    
    sidebarToggle.addEventListener('click', function() {
      sidebar.classList.toggle('collapsed');
      sidebarToggle.classList.toggle('collapsed');
      
      if (sidebar.classList.contains('collapsed')) {
        sidebarToggle.textContent = '▶';
      } else {
        sidebarToggle.textContent = '◀';
      }
    });
});

const score = {
    Red: 0,
    Blue: 0
};

let redTime = 600;
let blueTime = 600;
let intervalId = null;
let currentMove = "red";
let status = true;

function isResume(stat) {
    status = stat;
    if (status) {
        startTimer();
    } else {
        clearInterval(intervalId);
    }
}

let moveHistory = [];
let removedItems = [];
let lastMove = "";

function renderScore() {
    document.querySelector(".display-score").innerHTML = `<p>Red: ${score.Red}  Blue: ${score.Blue}</p>`;
    document.querySelector(".displayPlayerMove").innerHTML = `${currentMove} to play`;
    document.querySelector(".move-history").innerHTML = moveHistory;
}
renderScore();

function playMoveAudio() {
    const audio1 = document.getElementById("move");
    audio1?.play();
}

function playCreateAudio() {
    const audio2 = document.getElementById("create");
    audio2?.play();
}

function playIllegalAudio() {
    const audio3 = document.getElementById("illegal");
    audio3?.play();
}

function updateTimer(currentMove, time) {
    const mins = Math.floor(time / 60);
    const secs = Math.floor(time % 60);
    document.querySelector(`.${currentMove}-timer`).innerHTML = `${currentMove}: ${mins}:${secs}`;
    if (mins === 0 && secs === 0) {
        alert(currentMove === "red" ? "Blue won!" : "Red won!");
        location.reload();
    }
}

function startTimer() {
    clearInterval(intervalId);
    intervalId = setInterval(() => {
        if (currentMove === "red" && status) {
            redTime--;
            updateTimer("red", redTime);
        } else if (currentMove === "blue" && status) {
            blueTime--;
            updateTimer("blue", blueTime);
        }
    }, 1000);
}

const unlock = [0, 0, 1, 0];

function undo() {
    if (moveHistory.length === 0) return;
    lastMove = moveHistory.pop();
    removedItems.push(lastMove);
    const [player, a, b] = lastMove;
    data[b] = 0;
    if (a === 0) {
        if (player === "R") titan[0]++;
        else titan[1]++;
    } else {
        data[a] = player === "R" ? 1 : 2;
        moveHighlight(Node[b], Node[a], player === "R" ? "red" : "blue", () => {
            colorender();
        });
    }

    if (player === "R") {
        turn[0] = 1;
        turn[1] = 0;
        currentMove = "red";
    } else {
        turn[0] = 0;
        turn[1] = 1;
        currentMove = "blue";
    }

    alreadyClicked[0] = 0;
    alreadyClicked[1] = 0;
    Unlock();
    console.log(lastMove);
    console.log(unlock);
    updateScore();
    renderScore();
    if (a === 0) colorender();
    startTimer();
}

function redo() {
    if (removedItems.length === 0) return;
    const moveToRedo = removedItems.pop();
    moveHistory.push(moveToRedo);
    const player = moveToRedo[0].toUpperCase();
    const a = moveToRedo[1];
    const b = moveToRedo[2];

    if (a === 0) {
        data[b] = player === "R" ? 1 : 2;
        if (player === "R") titan[0]--;
        else titan[1]--;
    } else {
        data[a] = 0;
        data[b] = player === "R" ? 1 : 2;
        moveHighlight(Node[a], Node[b], player === "R" ? "red" : "blue", () => {
            colorender();
        });
    }

    if (player === "R") {
        turn[0] = 0;
        turn[1] = 1;
        currentMove = "blue";
    } else {
        turn[0] = 1;
        turn[1] = 0;
        currentMove = "red";
    }
    Unlock();
    updateScore();
    renderScore();
    if (a === 0) colorender();
    startTimer();
}

// Game board data
const data = Array(19).fill(0); // 1-18 used, 0 unused
const weight = [9, 8, 8, 9, 8, 8, 4, 5, 6, 4, 5, 6, 3, 2, 1, 2, 1, 1];
const hex = document.getElementById("hex");
const originalXCentre = window.innerWidth / 2; // Original center for lines
const nodeXCentre = originalXCentre; // Center for nodes (can be adjusted)
const leftOffset = 240; // Offset to move nodes left
const r = [100, 200, 300];
const yCentre = window.innerHeight / 2;
let k = 1;
let Node = [];

for (let i = 0; i < 3; i++) {
    for (let j = 0; j < 6; j++) {
        const angle = (Math.PI / 180) * 60 * j;
        let x = nodeXCentre + r[i] * Math.cos(angle); // Base x from nodeXCentre
        let y = yCentre + r[i] * Math.sin(angle);
        x = Math.round(x - leftOffset); // Apply left offset to nodes only
        y = Math.round(y);

        const node = document.createElement('button');
        node.className = "node";
        node.id = k;
        node.innerText = `${k}`;
        node.style.left = `${x}px`; // Use shifted x for nodes
        node.style.top = `${y}px`;
        node.value = k;
        node.addEventListener("click", moveTrack);
        hex.appendChild(node);
        Node[k] = [x, y]; // Store shifted coordinates
        k++;
    }
}

for (let i = 1; i <= 18; i++) {
    if (i % 6 === 0) {
        const xa = (Node[i][0] + Node[i - 5][0]) / 2 + leftOffset; // Adjust for node shift
        const ya = (Node[i][1] + Node[i - 5][1]) / 2;
        const p = document.createElement('p');
        p.className = "p";
        p.style.left = `${xa + 25}px`;
        p.style.top = `${ya + 60}px`;
        p.innerText = weight[i - 1];
        document.body.appendChild(p);
    }
    if ([1, 5, 3, 12, 10, 8].includes(i)) {
        const xa = (Node[i][0] + Node[i + 6][0]) / 2 + leftOffset; // Adjust for node shift
        const ya = (Node[i][1] + Node[i + 6][1]) / 2;
        const p = document.createElement('p');
        p.className = "p";
        p.style.left = `${xa + 30}px`;
        p.style.top = `${ya + 65}px`;
        p.innerText = "1";
        document.body.appendChild(p);
    }
    if (i % 6 !== 0) {
        const xa = (Node[i][0] + Node[i + 1][0]) / 2 + leftOffset; // Adjust for node shift
        const ya = (Node[i][1] + Node[i + 1][1]) / 2;
        const p = document.createElement('p');
        p.className = "p";
        p.style.left = `${xa + 15}px`;
        p.style.top = `${ya + 35}px`;
        p.innerText = weight[i - 1];
        document.body.appendChild(p);
    }
}

for (let i = 1; i <= 18; i++) {
    if (i % 6 !== 0) lineCreate(Node[i][0] + leftOffset, Node[i][1], Node[i + 1][0] + leftOffset, Node[i + 1][1]);
    if ([1, 5, 3, 12, 10, 8].includes(i)) lineCreate(Node[i][0] + leftOffset, Node[i][1], Node[i + 6][0] + leftOffset, Node[i + 6][1]);
    if (i % 6 === 0) lineCreate(Node[i][0] + leftOffset, Node[i][1], Node[i - 5][0] + leftOffset, Node[i - 5][1]);
}

function lineCreate(x1, y1, x2, y2) {
    const line = document.createElement("div");
    const dx = x2 - x1;
    const dy = y2 - y1;
    const length = Math.sqrt(dx * dx + dy * dy);
    const angle = Math.atan2(dy, dx) * (180 / Math.PI);
    line.style.position = "absolute";
    line.style.left = `${x1 + 17}px`;
    line.style.top = `${y1 + 70}px`;
    line.style.width = `${length}px`;
    line.style.height = "2px";
    line.style.backgroundColor = "black";
    line.style.transform = `rotate(${angle}deg)`;
    line.style.transformOrigin = "0 0";
    document.body.appendChild(line);
}

let scoredEdges = {};

function updateScore() {
    let scoreRed = 0;
    let scoreBlue = 0;
    for (let key in scoredEdges) {
        delete scoredEdges[key];
    }
    for (let i = 1; i <= 18; i++) {
        if (data[i] !== 0 && data[i + 1] !== 0 && data[i] === data[i + 1] && i % 6 !== 0) {
            const key = `${i}-${i + 1}`;
            if (!scoredEdges[key]) {
                data[i] === 1 ? scoreRed += weight[i - 1] : scoreBlue += weight[i - 1];
                scoredEdges[key] = true;
            }
        }
        if ([1, 5, 3, 12, 10, 8].includes(i) && data[i] !== 0 && data[i + 6] !== 0 && data[i] === data[i + 6]) {
            const key = `${i}-${i + 6}`;
            if (!scoredEdges[key]) {
                data[i] === 1 ? scoreRed += 1 : scoreBlue += 1;
                scoredEdges[key] = true;
            }
        }
        if (i % 6 === 0 && data[i] !== 0 && data[i - 5] !== 0 && data[i] === data[i - 5]) {
            const key = `${i}-${i - 5}`;
            if (!scoredEdges[key]) {
                data[i] === 1 ? scoreRed += weight[i - 1] : scoreBlue += weight[i - 1];
                scoredEdges[key] = true;
            }
        }
    }
    score.Red = scoreRed;
    score.Blue = scoreBlue;
    renderScore();
}

function Unlock() {
    if (!data.slice(13, 19).includes(0) || !data.slice(7, 13).includes(0)) {
        unlock[1] = 1;
    } else if (lastMove[1] === 0 && lastMove[2] >= 13 && !data.slice(7, 13).includes(0)) {
        unlock[1] = 0;
    }
    if (!data.slice(7, 13).includes(0) || !data.slice(1, 7).includes(0)) {
        unlock[0] = 1;
    }
    if (!data.slice(1, 7).includes(0)) {
        unlock[3] = 1;
    }
}

Unlock();

function Move(a, b) {
    let o = 0;
    a = Number(a);
    b = Number(b);
    console.log(`Moving from Node[${a}] = ${JSON.stringify(Node[a])} to Node[${b}] = ${JSON.stringify(Node[b])}`);

    const performMove = () => {
        data[b] = data[a];
        data[a] = 0;
        playMoveAudio();
        o = 1;
        lastMove = [data[b] === 1 ? "R" : "B", a, b];
        removedItems = [];
        moveHistory.push(lastMove);
        console.log(`Successfully moved from ${a} to ${b}`);
        moveHighlight(Node[a], Node[b], data[b] === 1 ? "red" : "blue");
        if (data[b] === 1) {
            turn[0] = 0;
            turn[1] = 1;
            currentMove = "blue";
        } else {
            turn[0] = 1;
            turn[1] = 0;
            currentMove = "red";
        }
    };

    if ((a === 12 && b === 18) || (a === 18 && b === 12)) performMove();
    else if (b % 6 === 0) {
        if (a === b - 5 || a === b - 1) performMove();
    } else if (a % 6 === 0) {
        if (a === b + 1 || a === b + 5) performMove();
    } else if ([1, 3, 5, 8, 10, 12].includes(a)) {
        if (a === b + 1 || a === b - 1 || a === b - 6) performMove();
    } else if ([1, 3, 5, 8, 10, 12].includes(b)) {
        if (a === b + 1 || a === b - 1 || a === b + 6) performMove();
    } else if (a === b + 1 || a === b - 1) performMove();

    if (o === 1) {
        Unlock();
        updateScore();
        renderScore();
        startTimer();
        return true;
    } else {
        playIllegalAudio();
        return false;
    }
}

const hexContainer = document.getElementById("hex");
const highlight = document.createElement('div');
highlight.className = "highlight";
hexContainer.appendChild(highlight);

function moveHighlight(p, q, color, callback) {
    const highlight = document.querySelector('.highlight');
    const offset = 16;
    highlight.style.transition = 'none';
    highlight.style.left = `${p[0] + offset}px`;
    highlight.style.top = `${p[1] + offset}px`;
    highlight.style.opacity = '0';
    highlight.style.backgroundColor = color;

    void highlight.offsetWidth;

    highlight.style.transition = 'left 0.5s ease-in-out, top 0.5s ease-in-out, opacity 0.5s ease-in-out';
    highlight.style.left = `${q[0] + offset}px`;
    highlight.style.top = `${q[1] + offset}px`;
    highlight.style.opacity = '0.8';

    setTimeout(() => {
        highlight.src = '';
        highlight.style.transition = 'opacity 0.2s ease-in-out';
        highlight.style.opacity = '0';
        if (callback) callback();
        Change();
        setTimeout(() => {
            highlight.style.transition = 'none';
            highlight.style.left = '0px';
            highlight.style.top = '0px';
        }, 200);
    }, 500);
}

function Change() {
    updateScore();
    colorender();
    Unlock();
    if (unlock[3] === 1) {
        if (score.Red > score.Blue) {
            alert("Red Wins");
            location.reload();
        } else if (score.Red === score.Blue) {
            alert("Match Drawn");
            location.reload();
        } else {
            alert("Blue Wins");
            location.reload();
        }
    }
}

const turn = [1, 0]; // red-0, blue-1
const move = [0, 0];
const titan = [4, 4];

function createTitan(id) {
    const button = document.getElementById(id);
    button.style.backgroundColor = currentMove;
    if (currentMove === 'red') {
        data[id] = 1;
        lastMove = ["R", 0, id];
        playCreateAudio();
    }
    if (currentMove === 'blue') {
        data[id] = 2;
        lastMove = ["B", 0, id];
        playCreateAudio();
    }
    removedItems = [];
    moveHistory.push(lastMove);
}

const alreadyClicked = [0, 0];

function moveTrack(event) {
    const id = Number(event.target.value);
    const isRedTurn = turn[0] === 1;
    const isBlueTurn = turn[1] === 1;
    const unlocked = unlock[Math.floor(id / 6.1)] === 1;

    if (isRedTurn) {
        if (alreadyClicked[0] === 0) {
            if (data[id] === 0 && unlocked) {
                if (titan[0] <= 0) playIllegalAudio();
                else if (id >= 1 && id <= 6 && unlock[3] === 1) playIllegalAudio();
                else {
                    createTitan(id);
                    titan[0]--;
                    turn[0] = 0;
                    turn[1] = 1;
                    currentMove = "blue";
                    alreadyClicked[0] = 0;
                    startTimer();
                    Change();
                }
            } else if (data[id] === 1) {
                alreadyClicked[0] = id;
            } else playIllegalAudio();
        } else {
            if (unlocked && Move(alreadyClicked[0], id)) {
                alreadyClicked[0] = 0;
            } else {
                alreadyClicked[0] = 0;
                playIllegalAudio();
            }
        }
    } else if (isBlueTurn) {
        if (alreadyClicked[1] === 0) {
            if (data[id] === 0 && unlocked) {
                if (titan[1] <= 0) playIllegalAudio();
                else if (id >= 1 && id <= 6 && unlock[3] === 1) playIllegalAudio();
                else {
                    createTitan(id);
                    titan[1]--;
                    turn[0] = 1;
                    turn[1] = 0;
                    currentMove = "red";
                    alreadyClicked[1] = 0;
                    startTimer();
                    Change();
                }
            } else if (data[id] === 2) {
                alreadyClicked[1] = id;
            } else playIllegalAudio();
        } else {
            if (unlocked && Move(alreadyClicked[1], id)) {
                alreadyClicked[1] = 0;
            } else {
                alreadyClicked[1] = 0;
                playIllegalAudio();
            }
        }
    }
    renderScore();
}

function colorender() {
    for (let i = 1; i <= 18; i++) {
        const button = document.getElementById(i);
        if (data[i] !== 0) {
            button.style.backgroundColor = data[i] === 1 ? 'red' : 'blue';
        } else {
            button.style.backgroundColor = '';
        }
    }
}

// Initialize the game on page load
document.addEventListener('DOMContentLoaded', initializeGameBoard);
window.addEventListener('resize', initializeGameBoard);
  </script>
</body>
</html>
